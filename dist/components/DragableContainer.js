var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _reactNativeFeather=require("react-native-feather");var _reactNativeReanimated=_interopRequireWildcard(require("react-native-reanimated"));var _jsxRuntime=require("react/jsx-runtime");var _this=this,_jsxFileName="/home/giacconidev/Documentos/RNDragableBtn/RNDragableBtn/src/components/DragableContainer.js";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&{}.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}var _worklet_4013063412321_init_data={code:"function DragableContainerJs1(){const{position}=this.__closure;return{transform:[{translateX:position.x.value},{translateY:position.y.value}],position:'absolute'};}",location:"/home/giacconidev/Documentos/RNDragableBtn/RNDragableBtn/src/components/DragableContainer.js",sourceMap:"{\"version\":3,\"names\":[\"DragableContainerJs1\",\"position\",\"__closure\",\"transform\",\"translateX\",\"x\",\"value\",\"translateY\",\"y\"],\"sources\":[\"/home/giacconidev/Documentos/RNDragableBtn/RNDragableBtn/src/components/DragableContainer.js\"],\"mappings\":\"AA2M8C,SAAAA,qBAAA,QAAAC,QAAA,OAAAC,SAAA,OAAO,CACjDC,SAAS,CAAE,CACT,CAAEC,UAAU,CAAEH,QAAQ,CAACI,CAAC,CAACC,KAAM,CAAC,CAChC,CAAEC,UAAU,CAAEN,QAAQ,CAACO,CAAC,CAACF,KAAM,CAAC,CACjC,CACDL,QAAQ,CAAE,UACZ,CAAC\",\"ignoreList\":[]}",version:"3.17.5"};var _worklet_14789694790274_init_data={code:"function DragableContainerJs2(){const{contentView}=this.__closure;return{height:contentView.height.value,width:contentView.width.value,maxWidth:contentView.width.value,maxHeight:contentView.height.value,backgroundColor:'transparent',zIndex:15};}",location:"/home/giacconidev/Documentos/RNDragableBtn/RNDragableBtn/src/components/DragableContainer.js",sourceMap:"{\"version\":3,\"names\":[\"DragableContainerJs2\",\"contentView\",\"__closure\",\"height\",\"value\",\"width\",\"maxWidth\",\"maxHeight\",\"backgroundColor\",\"zIndex\"],\"sources\":[\"/home/giacconidev/Documentos/RNDragableBtn/RNDragableBtn/src/components/DragableContainer.js\"],\"mappings\":\"AAsOgD,SAAAA,qBAAA,QAAAC,WAAA,OAAAC,SAAA,OAAO,CACnDC,MAAM,CAAEF,WAAW,CAACE,MAAM,CAACC,KAAK,CAChCC,KAAK,CAAEJ,WAAW,CAACI,KAAK,CAACD,KAAK,CAC9BE,QAAQ,CAAEL,WAAW,CAACI,KAAK,CAACD,KAAK,CACjCG,SAAS,CAAEN,WAAW,CAACE,MAAM,CAACC,KAAK,CACnCI,eAAe,CAAE,aAAa,CAC9BC,MAAM,CAAE,EACV,CAAC\",\"ignoreList\":[]}",version:"3.17.5"};var _worklet_15557100441081_init_data={code:"function DragableContainerJs3(){const{contentView}=this.__closure;return{transform:[{rotate:contentView.rotation.value+'deg'}]};}",location:"/home/giacconidev/Documentos/RNDragableBtn/RNDragableBtn/src/components/DragableContainer.js",sourceMap:"{\"version\":3,\"names\":[\"DragableContainerJs3\",\"contentView\",\"__closure\",\"transform\",\"rotate\",\"rotation\",\"value\"],\"sources\":[\"/home/giacconidev/Documentos/RNDragableBtn/RNDragableBtn/src/components/DragableContainer.js\"],\"mappings\":\"AAgPkD,SAAAA,qBAAA,QAAAC,WAAA,OAAAC,SAAA,OAAO,CACrDC,SAAS,CAAE,CAAC,CAAEC,MAAM,CAAEH,WAAW,CAACI,QAAQ,CAACC,KAAK,CAAG,KAAM,CAAC,CAC5D,CAAC\",\"ignoreList\":[]}",version:"3.17.5"};var DragableContainer=function DragableContainer(_ref){var x=_ref.x,y=_ref.y,height=_ref.height,minHeight=_ref.minHeight,maxHeight=_ref.maxHeight,width=_ref.width,minWidth=_ref.minWidth,maxWidth=_ref.maxWidth,rotation=_ref.rotation,resizeMode=_ref.resizeMode,index=_ref.index,selected=_ref.selected,onSelect=_ref.onSelect,onDelete=_ref.onDelete,children=_ref.children;var isDevelopment=process.env.NODE_ENV==='development';var FOUR_SQUARES="4-squares";var ONE_SQUARE="1-square";var item=(0,_react.useMemo)(function(){return{height:height||minHeight||100,width:width||minWidth||100,rotation:rotation||0,x:x||0,y:y||0};},[height,minHeight,width,minWidth,rotation]);var position={x:(0,_reactNativeReanimated.useSharedValue)(-1000),y:(0,_reactNativeReanimated.useSharedValue)(-1000)};var originOffset=(0,_react.useRef)({oX:0,oY:0});var contentView={height:(0,_reactNativeReanimated.useSharedValue)(item.height),width:(0,_reactNativeReanimated.useSharedValue)(item.width),rotation:(0,_reactNativeReanimated.useSharedValue)(item.rotation)};var initHeight=(0,_reactNativeReanimated.useSharedValue)(0);var initWidth=(0,_reactNativeReanimated.useSharedValue)(0);var initRotation=(0,_reactNativeReanimated.useSharedValue)(0);var buttonsSize=30;var _useState=(0,_react.useState)(0),_useState2=(0,_slicedToArray2.default)(_useState,2),layoutKey=_useState2[0],setLayoutKey=_useState2[1];var dimensions={width:(0,_reactNativeReanimated.useSharedValue)(0),height:(0,_reactNativeReanimated.useSharedValue)(0)};var windowDimensions=(0,_react.useRef)(_reactNative.Dimensions.get('window'));var _useState3=(0,_react.useState)(false),_useState4=(0,_slicedToArray2.default)(_useState3,2),buttonsAbove=_useState4[0],setButtonsAbove=_useState4[1];var checkButtonsPosition=(0,_react.useCallback)(function(){var containerBottom=position.y.value+contentView.height.value;var windowHeight=windowDimensions.current.height;var threshold=windowHeight-100;setButtonsAbove(containerBottom>threshold);},[position.y,contentView.height]);var getNewPosition=(0,_react.useCallback)(function(gestureState){var moveX=gestureState.moveX,moveY=gestureState.moveY;var height=dimensions.height;var _originOffset$current=originOffset.current,oX=_originOffset$current.oX,oY=_originOffset$current.oY;return{x:moveX-oX,y:moveY-oY-height.value/2-buttonsSize*1.5};},[dimensions]);var handleDrag=(0,_react.useCallback)(function(gestureState){var _getNewPosition=getNewPosition(gestureState),x=_getNewPosition.x,y=_getNewPosition.y;position.x.value=x;position.y.value=y;if(!!item){item.x=x;item.y=y;}checkButtonsPosition();},[position,getNewPosition,checkButtonsPosition]);var dragViewpanResponder=(0,_react.useRef)(_reactNative.PanResponder.create({onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return true;},onPanResponderMove:function onPanResponderMove(_,gestureState){return handleDrag(gestureState);}})).current;var handleResizeY=(0,_react.useCallback)(function(gestureState,y0){var newValue=y0?gestureState.y0-gestureState.moveY:gestureState.moveY-gestureState.y0;var newHeight=Math.max(newValue+initHeight.value,25);if(!!minHeight&&newHeight<minHeight)return;if(!!maxHeight&&newHeight>maxHeight)return;contentView.height.value=newHeight;if(newHeight>25&&y0)position.y.value=gestureState.moveY-(y0?-1*buttonsSize/2:buttonsSize/2);if(!!item)item.height=newHeight;checkButtonsPosition();},[contentView,initHeight,checkButtonsPosition]);var resizeYViewpanResponder=(0,_react.useRef)(_reactNative.PanResponder.create({onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return true;},onPanResponderMove:function onPanResponderMove(_,gestureState){return handleResizeY(gestureState,false);},onPanResponderRelease:function onPanResponderRelease(_,gestureState){initHeight.value=contentView.height.value;setLayoutKey(function(prevKey){return prevKey+1;});}})).current;var resizeYFinalViewpanResponder=(0,_react.useRef)(_reactNative.PanResponder.create({onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return true;},onPanResponderMove:function onPanResponderMove(_,gestureState){return handleResizeY(gestureState,true);},onPanResponderRelease:function onPanResponderRelease(_,gestureState){initHeight.value=contentView.height.value;setLayoutKey(function(prevKey){return prevKey+1;});}})).current;var handleResizeX=(0,_react.useCallback)(function(gestureState,x0){var newValue=x0?gestureState.x0-gestureState.moveX:gestureState.moveX-gestureState.x0;var newWidth=Math.max(newValue+initWidth.value,25);if(!!minWidth&&newWidth<minWidth)return;if(!!maxWidth&&newWidth>maxWidth)return;contentView.width.value=newWidth;if(newWidth>25&&x0)position.x.value=gestureState.moveX-(x0?-1*buttonsSize/2:buttonsSize/2);if(!!item)item.width=newWidth;checkButtonsPosition();},[contentView,initWidth,checkButtonsPosition]);var resizeXViewpanResponder=(0,_react.useRef)(_reactNative.PanResponder.create({onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return true;},onPanResponderMove:function onPanResponderMove(_,gestureState){return handleResizeX(gestureState,false);},onPanResponderRelease:function onPanResponderRelease(_,gestureState){initWidth.value=contentView.width.value;setLayoutKey(function(prevKey){return prevKey+1;});}})).current;var resizeXFinalViewpanResponder=(0,_react.useRef)(_reactNative.PanResponder.create({onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return true;},onPanResponderMove:function onPanResponderMove(_,gestureState){return handleResizeX(gestureState,true);},onPanResponderRelease:function onPanResponderRelease(_,gestureState){initWidth.value=contentView.width.value;setLayoutKey(function(prevKey){return prevKey+1;});}})).current;var resizeXYFinalViewpanResponder=(0,_react.useRef)(_reactNative.PanResponder.create({onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return true;},onPanResponderMove:function onPanResponderMove(_,gestureState){handleResizeY(gestureState,false);handleResizeX(gestureState,false);},onPanResponderRelease:function onPanResponderRelease(_,gestureState){initHeight.value=contentView.height.value;initWidth.value=contentView.width.value;setLayoutKey(function(prevKey){return prevKey+1;});}})).current;var onRotate=(0,_react.useCallback)(function(gestureState){var newValue=gestureState.x0-gestureState.moveX;contentView.rotation.value=newValue+initRotation.value;if(!!item)item.rotation=contentView.rotation.value;},[contentView,initRotation]);var rotateViewpanResponder=(0,_react.useRef)(_reactNative.PanResponder.create({onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return true;},onPanResponderMove:function onPanResponderMove(_,gestureState){return onRotate(gestureState);},onPanResponderRelease:function onPanResponderRelease(_,gestureState){initRotation.value=contentView.rotation.value;}})).current;var dragAnimationStyle=(0,_reactNativeReanimated.useAnimatedStyle)(function(){var _e=[new global.Error(),-2,-27];var DragableContainerJs1=function DragableContainerJs1(){return{transform:[{translateX:position.x.value},{translateY:position.y.value}],position:'absolute'};};DragableContainerJs1.__closure={position:position};DragableContainerJs1.__workletHash=4013063412321;DragableContainerJs1.__initData=_worklet_4013063412321_init_data;DragableContainerJs1.__stackDetails=_e;return DragableContainerJs1;}());(0,_react.useEffect)(function(){position.x.value=item.x;position.y.value=item.y;initHeight.value=contentView.height.value;initWidth.value=contentView.width.value;initRotation.value=contentView.rotation.value;checkButtonsPosition();},[item,checkButtonsPosition]);var onComponentLayout=(0,_react.useCallback)(function(event){var _event$nativeEvent$la=event.nativeEvent.layout,width=_event$nativeEvent$la.width,height=_event$nativeEvent$la.height,x=_event$nativeEvent$la.x,y=_event$nativeEvent$la.y,top=_event$nativeEvent$la.top,left=_event$nativeEvent$la.left;originOffset.current={oX:x+(left|0)+width/2,oY:y+(top|0)+height/2};dimensions.width.value=width;dimensions.height.value=height;checkButtonsPosition();},[dimensions,checkButtonsPosition]);var resizeAnimationStyle=(0,_reactNativeReanimated.useAnimatedStyle)(function(){var _e=[new global.Error(),-2,-27];var DragableContainerJs2=function DragableContainerJs2(){return{height:contentView.height.value,width:contentView.width.value,maxWidth:contentView.width.value,maxHeight:contentView.height.value,backgroundColor:'transparent',zIndex:15};};DragableContainerJs2.__closure={contentView:contentView};DragableContainerJs2.__workletHash=14789694790274;DragableContainerJs2.__initData=_worklet_14789694790274_init_data;DragableContainerJs2.__stackDetails=_e;return DragableContainerJs2;}());var rotationAnimationStyle=(0,_reactNativeReanimated.useAnimatedStyle)(function(){var _e=[new global.Error(),-2,-27];var DragableContainerJs3=function DragableContainerJs3(){return{transform:[{rotate:contentView.rotation.value+'deg'}]};};DragableContainerJs3.__closure={contentView:contentView};DragableContainerJs3.__workletHash=15557100441081;DragableContainerJs3.__initData=_worklet_15557100441081_init_data;DragableContainerJs3.__stackDetails=_e;return DragableContainerJs3;}());var childMemo=(0,_react.useMemo)(function(){return children;},[]);var styles=(0,_react.useMemo)(function(){return _reactNative.StyleSheet.create({container:{borderWidth:1,borderStyle:'dashed',alignItems:'center',justifyContent:'center'},buttonsContainer:{position:'absolute',bottom:-60,left:0,right:0,flexDirection:'row',justifyContent:'space-around',alignItems:'center',paddingHorizontal:10,zIndex:16},buttonsAbove:{bottom:'auto',top:-60},button:{borderRadius:20,backgroundColor:'#fff',justifyContent:'center',alignItems:'center',shadowColor:'#000',shadowOffset:{width:0,height:2},shadowOpacity:0.25,shadowRadius:3.84,elevation:5},resizeHandles:{position:'absolute',width:'100%',height:'100%'},resizeHandle:{position:'absolute',width:30,height:30,backgroundColor:'#fa7f7c',borderRadius:20,zIndex:16},leftHandle:{left:-30,top:'50%',transform:[{translateY:-10}],zIndex:16},rightHandle:{right:-30,top:'50%',transform:[{translateY:-10}],zIndex:16},topHandle:{top:-30,left:'50%',transform:[{translateX:-10}],zIndex:16},bottomHandle:{bottom:-30,left:'50%',transform:[{translateX:-10}],zIndex:16},botRightHandle:{bottom:-15,right:-15,zIndex:16}});},[]);return(0,_jsxRuntime.jsx)(_reactNativeReanimated.default.View,{selectable:false,draggable:false,style:[dragAnimationStyle,{zIndex:selected?15:3}],onLayout:onComponentLayout,children:(0,_jsxRuntime.jsxs)(_reactNative.Pressable,{onPress:function onPress(){return onSelect(index);},style:[styles.container,{borderColor:selected?'#fa7f7c':'transparent'}],draggable:false,selectable:false,children:[(0,_jsxRuntime.jsx)(_reactNativeReanimated.default.View,{style:[rotationAnimationStyle,resizeAnimationStyle],children:childMemo}),selected&&(0,_jsxRuntime.jsxs)(_reactNative.View,{style:[{visibility:selected?'visible':'hidden',opacity:selected?1:0},styles.buttonsContainer,buttonsAbove&&styles.buttonsAbove],children:[(0,_jsxRuntime.jsx)(_reactNative.View,Object.assign({},rotateViewpanResponder.panHandlers,{style:[{disabled:!selected,width:buttonsSize,height:buttonsSize},styles.button,styles.rotateButton],children:(0,_jsxRuntime.jsx)(_reactNativeFeather.RotateCcw,{stroke:"black",width:buttonsSize/2,height:buttonsSize/2})})),(0,_jsxRuntime.jsx)(_reactNative.View,Object.assign({},dragViewpanResponder.panHandlers,{style:[{disabled:!selected,width:buttonsSize,height:buttonsSize},styles.button,styles.moveButton],children:(0,_jsxRuntime.jsx)(_reactNativeFeather.Move,{stroke:"black",width:buttonsSize/2,height:buttonsSize/2})})),(0,_jsxRuntime.jsx)(_reactNative.Pressable,Object.assign({},isDevelopment?{testID:"deleteButton"}:{},{onPress:onDelete,style:[{disabled:!selected,width:buttonsSize,height:buttonsSize},styles.button,styles.deleteButton],children:(0,_jsxRuntime.jsx)(_reactNativeFeather.Trash2,{stroke:"black",width:buttonsSize/2,height:buttonsSize/2})}))]}),selected&&resizeMode===FOUR_SQUARES&&(0,_jsxRuntime.jsx)(_reactNative.View,Object.assign({},resizeXFinalViewpanResponder.panHandlers,{style:[{disabled:!selected,visibility:selected?'visible':'hidden',opacity:selected?1:0,width:buttonsSize,height:buttonsSize},styles.resizeHandle,styles.leftHandle]})),selected&&resizeMode===FOUR_SQUARES&&(0,_jsxRuntime.jsx)(_reactNative.View,Object.assign({},resizeYViewpanResponder.panHandlers,{style:[{disabled:!selected,visibility:selected?'visible':'hidden',opacity:selected?1:0,width:buttonsSize,height:buttonsSize},styles.resizeHandle,styles.bottomHandle]})),selected&&resizeMode===FOUR_SQUARES&&(0,_jsxRuntime.jsx)(_reactNative.View,Object.assign({},resizeXViewpanResponder.panHandlers,{style:[{disabled:!selected,visibility:selected?'visible':'hidden',opacity:selected?1:0,width:buttonsSize,height:buttonsSize},styles.resizeHandle,styles.rightHandle]})),selected&&resizeMode===FOUR_SQUARES&&(0,_jsxRuntime.jsx)(_reactNative.View,Object.assign({},resizeYFinalViewpanResponder.panHandlers,{style:[{disabled:!selected,visibility:selected?'visible':'hidden',opacity:selected?1:0,width:buttonsSize,height:buttonsSize},styles.resizeHandle,styles.topHandle]})),selected&&resizeMode===ONE_SQUARE&&(0,_jsxRuntime.jsx)(_reactNative.View,Object.assign({},resizeXYFinalViewpanResponder.panHandlers,{style:[{disabled:!selected,visibility:selected?'visible':'hidden',opacity:selected?1:0,width:buttonsSize,height:buttonsSize},styles.resizeHandle,styles.botRightHandle]}))]})},`dragable-text-${index}-layoutKey-${layoutKey}`);};var _default=exports.default=DragableContainer;